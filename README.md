# Signal-Processing - решение задачи с семантическим разрывом

## Выбранные объекты:
- Объект А - воротца;
- Объект Б - пластина.

## Требования к объектам и окружению:
Даны воротца и пластина. 
- Пластина влезает в нишу ворот в каких-то положениях, в каких-то не влезает, это зависит от угла ее поворота и того, на какой из граней она лежит.
- Цвета ворот и пластины контрастны друг другу.
- Ниша ворот и пластина прямоугольной формы.
- Задник на фотографии белый, а поверхность-пол - белая клетчатая тетрадная бумага.

## Требования к фотографиям:
- Фотографии сделаны на камеру с разрешением не менее 9.5МП.
- Освещение искусственное, без засвеченных областей и теней по интенсивности сопоставимых с самими объектами.
- Объекты полностью попадают в кард и в фокусе.
- Угол съемки  - на пролет ворот, всегда постоянен с точностью 2-3 градуса (условия лабораторные и камера фиксирована).

## Задача:

Требуется определить, влезет ли пластина в нишу при параллельном переносе(бинарная классификация - YES, если влезет, NO, если не влезет). В качестве дополнения может быть рассмотрена задача подсчета угла поворота требуемого для прохождения пластины в нишу с точностью до 5-10 градусов(в данном варианте не реализовано).


## Датасет:

Ознакомиться с образцами выборки можно по ссылке - https://drive.google.com/drive/folders/1XL2db2UVi6GiDcnMneswp40IV3YnX9xg?usp=sharing.

## Алгоритм решения
- сглаживание фильтром Гаусса
- бинаризация Оцу
- морфологические операции для удаления шумов от клетчатой бумаги на полу
- поиск контуров с помощью cv.findContours
- построение ограничивающего прямоугольника
- вычисление его пропорций
- сравнение пропорции с порогом и принятие решения

Объяснение моего хода мысли можно увидеть в пункте - Идея.
Приведу иллюстрации шагов алгоритма:
![Без названия](https://user-images.githubusercontent.com/39533142/113438685-bea7c700-93f1-11eb-8128-f080a92fa4fd.png)

Мною было решено идти не по пути, который изначально был мною обозначен в плане решения(с использованием особых точек). Я пробовала составлять дескриптор SIFT для ворот и рамки и матчить точки на изображении с референсом объектов, однако воротца распознавались гораздо лучше пластинки, и я пока отошла от этого подхода. Возможно, мне удастся привлечь найденные особые точки в будущем для уточнения bounding boxes, получаемых в результате применения cv.findContours.

## Идея
Для рассматриваемой в задаче пластинки существует некоторое пороговое положение, при котором она еще пролезает в ворота. В терминах ограничивающего прямоугольника это положение с учетом постоянства угла съемки задается вне зависимости от близости пластинки к камере некоторым соотношением сторон ограничивающего пластику прямоугольника(bounding box). Высчитываем это пороговое значение соотношения сторон(width/height) по специально снятой фотографии этого краевого случая. Для поступающей на вход фотографии высчитываем то же соотношение и, если оно больше - ответ "NO", если меньше - ответ "YES".

<img width="937" alt="idea" src="https://user-images.githubusercontent.com/39533142/111867923-36a0d680-8988-11eb-8a95-ca6b1b5c92ba.png">

## Полученные результаты и над чем еще надо работать
- Точность достигается пока не очень большая - 0.64.
- Это так из-за ошибок при нахождении ограничивающих прямоугольников.
- Далее для улучшения работы модели можно подумать над другими способами нахождения bounding boxes. 

## Запуск программы
Код на питоне - main.py можно запустить через командную строку так: 
- **python main.py -i <path_to_image>** для классификации одного изрбражения
- **python main.py -d <path_to_dir>** для классификации всех изображений папки

Так же можно задавать формат изображений для классификации, включать и выключать визуализауию промежуточных шагов, передавать для обучения классификатора свое изображение с краевым случаем. Однако эти параметры заданы по умолчанию. Подробнее можно ознакомиться с ключами и использованием так **python main.py -h**, это вызовет справку.
